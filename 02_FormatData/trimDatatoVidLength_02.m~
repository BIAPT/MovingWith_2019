% Dannie Fu July 9 2020
%
% This script cuts out the EDA, TEMP, HR, and HRVYZ signals before the start of the Moving With
% videos.
%
% Need to specify LOAD_DIR and VIDEO_START variables. Make sure
% VIDEO_START is for the session you are loading the data from. 
% 
% ** Note: participants with orange phones have a different
% start_recording_time.txt than the other participants
%
% ------------------

%%
clear;

% Params to change
LOAD_DIR = "/Volumes/Seagate/3. Session_Nov_14/P1_TP001376_blue";
VIDEO_START = importdata("/Volumes/Seagate/3. Session_Nov_14/Original Data/start_recording_time.txt");

% Load data
load(strcat(LOAD_DIR,"/clean.mat"));

% Trim data
[clean_trimmed.TEMP, clean_trimmed.HR, clean_trimmed.EDA, clean_trimmed.HRVYZ] = ...
    trimData(TEMP,HR.mat,EDA.mat,HRVYZ,VIDEO_START);

% Save data
OUT_DIR = strcat(LOAD_DIR,'/');
save(strcat(OUT_DIR,'clean_trimmed.mat'),'-struct','clean_trimmed');
    
%% Function to trim the data 

function [TEMP_cut, HR_cut, EDA_cut, HRVYZ_cut] = trimData(TEMP,HR,EDA,HRVYZ,video_start)

% Cut out data before start of video
% Temp and EDA are same length because they both have 15Hz sampling rate
[~, idx_Start] = min(abs(EDA(:,1) - video_start));
EDA_cut = EDA(idx_Start:end,:);
TEMP_cut = TEMP(idx_Start:end,:);

% HRV has 4 HZ sampling rate 
[~, idx_Start] = min(abs(HR(:,1) - video_start));
HR_cut = HR(idx_Start:end,:);

[~, idx_Start] = min(abs(HRVYZ(:,1) - video_start));
HRVYZ_cut = HRVYZ(idx_Start:end,:);

end 